<!DOCTYPE html>
<html lang="it" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark-blue fixed-top no-print">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#"><i class="bi bi-person-workspace"></i> Coach Dashboard</a>
            <button class="btn btn-outline-secondary ms-auto" id="logout-btn" title="Logout" style="display: none;"><i class="bi bi-unlock-fill"></i></button>
        </div>
    </nav>

    <main class="container-fluid mt-5 pt-3">
        <div id="alerts-container"></div>
        
        <div id="home-section" class="printable-area">
            <div class="row my-4">
                <div class="col-12 d-flex align-items-center gap-2">
                    <h2 class="main-title mb-0">Home Riepilogo</h2>
                    <button class="btn btn-sm btn-outline-secondary ms-2 no-print print-section-btn"><i class="bi bi-printer-fill"></i></button>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-6 mb-4"><div class="card h-100"><div class="card-body text-center"><h5 class="card-title text-muted">ATLETI</h5><p class="display-4" id="home-total-athletes">0</p></div></div></div>
                <div class="col-lg-3 col-md-6 mb-4"><div class="card h-100"><div class="card-body" id="home-next-session"><h5 class="card-title text-muted">PROSSIMA</h5><p class="text-muted">Nessuna pianificata</p></div></div></div>
                <div class="col-lg-3 col-md-6 mb-4"><div class="card h-100"><div class="card-body" id="home-top-performer"><h5 class="card-title text-muted">TOP PERFORMER</h5><p class="text-muted">Nessun dato</p></div></div></div>
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title text-muted">AZIONI</h5>
                            <div class="d-grid gap-2 no-print">
                                <button class="btn btn-primary-custom" id="quick-add-athlete-btn">Nuovo Atleta</button>
                                <button class="btn btn-secondary" id="quick-plan-session-btn">Nuova Sessione</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card"><div class="card-body text-center">
                        <h5 class="text-muted mb-3">Statistiche Stagionali</h5>
                        <div class="d-flex justify-content-around flex-wrap" id="season-stats-container">
                            <div><h6>Partite</h6><p id="stat-pg" class="h4">0</p></div>
                            <div><h6>V-P-S</h6><p id="stat-vps" class="h4">0-0-0</p></div>
                            <div><h6>Gol Fatti</h6><p id="stat-gf" class="h4">0</p></div>
                            <div><h6>Gol Subiti</h6><p id="stat-gs" class="h4">0</p></div>
                            <div><h6>Diff. Reti</h6><p id="stat-dr" class="h4">0</p></div>
                        </div>
                    </div></div>
                </div>
            </div>
        </div>

        <div class="row my-4 no-print">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center d-flex flex-wrap justify-content-center gap-2">
                         <a href="#formazione-section" class="btn btn-secondary">Formazione</a>
                         <a href="#calendario-section" class="btn btn-secondary">Calendario</a>
                         <a href="#squadra-section" class="btn btn-secondary">Rosa</a>
                         <a href="#match-results-section" class="btn btn-secondary">Partite</a>
                         <a href="#monitoraggio-gps-section" class="btn btn-secondary">GPS</a>
                         <a href="#hall-of-fame-section" class="btn btn-secondary">Hall of Fame</a>
                    </div>
                </div>
            </div>
        </div>

        <hr class="my-5 no-print">

        <div id="formazione-section" class="printable-area">
            <h2 class="main-title">Modulo Formazione</h2>
            <div class="row mt-3">
                <div class="col-lg-9 mb-4">
                    <div id="pitch-wrapper">
                        <div id="field-container" class="drop-zone">
                            <div class="field-line halfway-line"></div><div class="field-circle center-circle"></div>
                            <div class="field-box penalty-box-top"></div><div class="field-box goal-box-top"></div>
                            <div class="field-box penalty-box-bottom"></div><div class="field-box goal-box-bottom"></div>
                        </div>
                        <div id="field-bench-area" class="drop-zone"></div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card">
                        <div class="card-header">Strumenti</div>
                        <div class="card-body">
                            <div id="formation-tools" class="d-flex gap-2 flex-wrap">
                                <div class="tool-item" data-item-type="captain-c">(C)</div>
                                <div class="tool-item" data-item-type="captain-vc">(VC)</div>
                                <div class="tool-item ball-tool" data-item-type="ball">⚽</div>
                                <div class="tool-item opponent-tool" data-item-type="opponent">●</div>
                            </div>
                        </div>
                        <div class="card-header mt-3">Disponibili</div>
                        <div class="card-body p-2 drop-zone" id="available-list" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>

        <hr class="my-5 no-print">

        <div id="calendario-section" class="printable-area">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="main-title mb-0">Calendario</h2>
                <button class="btn btn-primary-custom no-print" id="add-session-btn">Pianifica</button>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button id="prev-month-btn" class="btn btn-outline-secondary no-print"><i class="bi bi-chevron-left"></i></button>
                        <h4 id="current-month-year"></h4>
                        <button id="next-month-btn" class="btn btn-outline-secondary no-print"><i class="bi bi-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid text-center fw-bold mb-2">
                        <div>Lun</div><div>Mar</div><div>Mer</div><div>Gio</div><div>Ven</div><div>Sab</div><div>Dom</div>
                    </div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                </div>
            </div>
        </div>

        <hr class="my-5 no-print">

        <div id="squadra-section" class="printable-area">
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                <h2 class="main-title mb-0">Gestione Squadra</h2>
                <div class="d-flex gap-2 no-print">
                     <button class="btn btn-primary-custom" id="add-athlete-btn">Aggiungi Atleta</button>
                     <input type="file" id="import-file-input" class="d-none" accept=".json">
                     <label for="import-file-input" class="btn btn-secondary">Importa</label>
                     <button class="btn btn-secondary" id="export-all-data-btn">Esporta</button>
                </div>
            </div>
            <div class="row" id="athlete-grid"></div>
        </div>

        <hr class="my-5 no-print">
        
        <div id="match-results-section" class="printable-area">
            <div class="d-flex justify-content-between mb-3">
                <h2 class="main-title">Risultati Partite</h2>
                <button class="btn btn-primary-custom no-print" id="add-match-btn">Aggiungi Partita</button>
            </div>
            <div class="row" id="match-results-container"></div>
            <div class="row mt-4">
                <div class="col-md-7">
                    <div class="card"><div class="card-body"><canvas id="matchResultsChart"></canvas></div></div>
                </div>
                <div class="col-md-5">
                    <div class="card mb-3"><div class="card-body"><h5 class="card-title">Marcatori</h5><div id="top-scorers-container"></div></div></div>
                </div>
            </div>
        </div>

        <hr class="my-5 no-print">

        <div id="hall-of-fame-section" class="printable-area">
             <h2 class="main-title mb-3">Hall of Fame</h2>
             <div id="hall-of-fame-container" class="d-flex flex-wrap gap-3 justify-content-center"></div>
        </div>

        <hr class="my-5 no-print">

        <div id="monitoraggio-gps-section" class="printable-area mt-5">
            <h2 class="main-title">Monitoraggio GPS</h2>
            <div class="card p-3 mb-3 no-print">
                <div class="row g-2">
                    <div class="col-md-8" id="performance-selectors-container"></div>
                    <div class="col-md-4 d-flex align-items-end gap-2">
                        <select id="performance-metric-selector" class="form-select"></select>
                        <button class="btn btn-primary-custom" id="add-comparison-btn">Confronta</button>
                    </div>
                </div>
            </div>
            <div class="card"><div class="card-body"><canvas id="performanceChart"></canvas></div></div>
            <div class="mt-4" id="performance-table-container"></div>
        </div>

    </main>

    <div class="modal fade" id="passwordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Accesso Richiesto</h5></div>
                <div class="modal-body">
                    <form id="password-form">
                        <input type="password" class="form-control mb-2" id="password-input" placeholder="Password" required>
                        <div id="password-error" class="text-danger small mb-2" style="display:none;">Errata</div>
                        <button type="submit" class="btn btn-primary-custom w-100">Accedi</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="athleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="athleteModalLabel">Gestisci Atleta</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="athlete-form">
                        <input type="hidden" id="modal-athlete-id">
                        <div class="mb-3"><label>Nome Cognome</label><input type="text" class="form-control" id="athlete-name" required></div>
                        <div class="mb-3"><label>Ruolo</label><input type="text" class="form-control" id="athlete-role" required></div>
                        <div class="mb-3"><label>Numero</label><input type="number" class="form-control" id="athlete-number" required></div>
                        <div class="mb-3"><label>Foto</label><input type="file" class="form-control" id="athlete-avatar-input"><input type="hidden" id="athlete-avatar-base64"></div>
                        <div class="mb-3"><label>Scadenza Visita</label><input type="date" class="form-control" id="scadenza-visita"></div>
                        <div class="form-check"><input type="checkbox" class="form-check-input" id="athlete-captain"><label class="form-check-label" for="athlete-captain">Capitano</label></div>
                        <div class="form-check"><input type="checkbox" class="form-check-input" id="athlete-vice-captain"><label class="form-check-label" for="athlete-vice-captain">Vice Capitano</label></div>
                    </form>
                </div>
                <div class="modal-footer"><button type="submit" form="athlete-form" class="btn btn-primary-custom">Salva</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="sessionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="sessionModalLabel">Sessione</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="session-form">
                        <input type="hidden" id="session-id">
                        <div class="mb-2"><label>Data</label><input type="date" class="form-control" id="session-date" required></div>
                        <div class="mb-2"><label>Titolo</label><input type="text" class="form-control" id="session-title" required></div>
                        <div class="mb-2"><label>Ora</label><input type="time" class="form-control" id="session-time"></div>
                        <div class="mb-2"><label>Luogo</label><input type="text" class="form-control" id="session-location"></div>
                        <div class="mb-2"><label>Descrizione</label><textarea class="form-control" id="session-description"></textarea></div>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-danger" id="delete-session-btn" style="display:none">Elimina</button>
                    <button type="submit" form="session-form" class="btn btn-primary-custom">Salva</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="matchResultModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Risultato Partita</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="match-result-form">
                        <input type="hidden" id="match-id">
                        <div class="row mb-3">
                            <div class="col-md-4"><label>Data</label><input type="date" class="form-control" id="match-date" required></div>
                            <div class="col-md-4"><label>Avversario</label><input type="text" class="form-control" id="match-opponent-name" required></div>
                            <div class="col-md-4"><label>Casa/Trasferta</label><select class="form-select" id="match-location"><option value="home">Casa</option><option value="away">Trasferta</option></select></div>
                        </div>
                        <div class="row mb-3 text-center align-items-center">
                            <div class="col-5"><label>GO Sport</label><input type="number" class="form-control" id="match-my-team-score"></div>
                            <div class="col-2">-</div>
                            <div class="col-5"><label>Avversario</label><input type="number" class="form-control" id="match-opponent-score"></div>
                        </div>
                        <hr>
                        <h6>Marcatori (GO Sport)</h6>
                        <div id="scorers-container" class="d-grid gap-2 mb-2"></div>
                        <button type="button" class="btn btn-sm btn-secondary" id="add-scorer-btn">+ Marcatore</button>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-danger" id="delete-match-btn" style="display:none">Elimina</button>
                    <button type="submit" form="match-result-form" class="btn btn-primary-custom">Salva</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="gpsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Dati GPS: <span id="modal-athlete-name-gps"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="gps-form">
                        <input type="hidden" id="modal-athlete-id-gps">
                        <input type="hidden" id="gps-session-id">
                        <select id="gps-session-selector" class="form-select mb-3"></select>
                        <div class="row g-2">
                             <div class="col-md-4"><label>Data</label><input type="date" id="gps-data_di_registrazione" class="form-control" required></div>
                             <div class="col-md-4"><label>Tipo</label><select id="gps-tipo_sessione" class="form-select"><option value="Allenamento">Allenamento</option><option value="Partita">Partita</option><option value="Individual">Individual</option></select></div>
                             <div class="col-md-4"><label>Dist. Tot (m)</label><input type="number" step="0.1" id="gps-distanza_totale" class="form-control"></div>
                             <div class="col-md-4"><label>Tempo (min)</label><input type="number" step="0.1" id="gps-tempo_totale" class="form-control"></div>
                             <div class="col-md-4"><label>Vel Max (km/h)</label><input type="number" step="0.1" id="gps-velocita_massima" class="form-control"></div>
                             <div class="col-md-4"><label>Sprint (m)</label><input type="number" step="0.1" id="gps-distanza_sprint" class="form-control"></div>
                        </div>
                        <div id="match-stats-fields" style="display:none;" class="mt-3 border-top pt-2">
                            <h6>Statistiche Partita</h6>
                            <div class="row g-2">
                                <div class="col-3"><label>Minuti</label><input type="number" id="gps-minuti_giocati" class="form-control"></div>
                                <div class="col-3"><label>Gol</label><input type="number" id="gps-gol" class="form-control"></div>
                                <div class="col-3"><label>Assist</label><input type="number" id="gps-assist" class="form-control"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" id="delete-gps-session-btn" disabled>Elimina Sessione</button>
                    <button type="submit" form="gps-form" class="btn btn-primary-custom">Salva</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>